"use strict";class JX{static async post(t,a,{headers:r,raw:o}={headers:{},raw:!1}){let n=!0;var e;r&&(e=r["Content-Type"]?String(r["Content-Type"]):"application/json; charset=UTF-8",n=r["Content-Type"]?RegExp(/json/i).exec(r["Content-Type"]):n,r["Content-Type"]&&delete r["Content-Type"],r["Content-Type"]=e);try{let e=a;a&&"object"==typeof a&&(e=JSON.stringify(a));var s=await window.fetch.bind(window)(t,{headers:r,method:"POST",redirect:"follow",credentials:"include",body:e});return o?s:n?s.json():s.text()}catch(e){console.error(e)}}static async get(e,{headers:t,raw:a}={headers:{},raw:!1}){let r=!0;var o;t&&(o=t["Content-Type"]?String(t["Content-Type"]):"application/json; charset=UTF-8",r=t["Content-Type"]?RegExp(/json/i).exec(t["Content-Type"]):r,t["Content-Type"]&&delete t["Content-Type"],t["Content-Type"]=o);try{var n=await window.fetch.bind(window)(e,{headers:t,method:"GET",redirect:"follow",credentials:"include",mode:"no-cors"});return a?n:r?n.json():n.text()}catch(e){console.error(e)}}static async consultar(a){a=a.replace(/(\r\n|\n|\r)/gm,"");var r=window.location.origin+"/mge/service.sbr?serviceName=DbExplorerSP.executeQuery&outputType=json",a=`{ "serviceName": "DbExplorerSP.executeQuery", "requestBody": { "sql": "${a}" } }`,a=JSON.parse(a),r=await JX.post(r,a);{let e=[],t="string"==typeof(a=r)?JSON.parse(a):a,o=(t.data?t=t.data.responseBody:t.responseBody&&(t=t.responseBody),t.fieldsMetadata||[]);return(a=t.rows||[]).length&&a.forEach(a=>{let r={};o.forEach((e,t)=>r[e.name]=a[t]),e.push(r)}),e}}static acionarBotao(e,{tipo:t,idBotao:a,entidade:r,nomeProcedure:o}={tipo:"java",idBotao:0}){function n(t){let a={params:{param:[]}};return Object.keys(t).forEach(e=>a.params.param.push({type:"string"==typeof t[e]?"S":"I",paramName:e,$:t[e]})),a}let s="",i={};switch(t.toLowerCase()){case"js":s="ActionButtonsSP.executeScript",i={serviceName:s,requestBody:{runScript:{actionID:a,...n(e)}}};break;case"java":s="ActionButtonsSP.executeJava",i={serviceName:s,requestBody:{javaCall:{actionID:a,...n(e)}}};break;case"sql":if(!r)return void console.error("Entidade (parametro entidade) é necessária para a execução!");if(!o)return void console.error("Nome da procedure (parametro nomeProcedure) é necessária para a execução!");s="ActionButtonsSP.executeSTP",i={serviceName:s,requestBody:{stpCall:{actionID:a,rootEntity:r,procName:o,...n(e)}}}}t=`${window.location.origin}/mge/service.sbr?serviceName=${s}&outputType=json`;return JX.post(t,i)}static _salvar(e,t,a){var r=window.location.origin+"/mge/service.sbr?serviceName=CRUDServiceProvider.saveRecord&outputType=json",e=function(a,e,r){if(e={serviceName:"CRUDServiceProvider.saveRecord",requestBody:{dataSet:{rootEntity:e,includePresentationFields:"N",dataRow:{localFields:Object.keys(a).reduce((e,t)=>({...e,[t.toUpperCase()]:{$:String(a[t])}}),{})},entity:{fieldset:{list:Object.keys(a).map(e=>e.toUpperCase()).join(",")}}}}},r){let t={};Object.keys(r).forEach(e=>t={...t,[e.toUpperCase()]:{$:String(r[e])}}),e.requestBody.dataSet.dataRow.key=t}return e}(e,t,a);return JX.post(r,e)}static async salvar(e,t,a){var r,o=[];if(!(a&&a instanceof Array&&a.length))return JX._salvar(e,t,a);for(r of a)o.push(await JX._salvar(e,t,r));return o}static async novoSalvar(e,t,a){var r=window.location.origin+"/mge/service.sbr?serviceName=DatasetSP.save&outputType=json",o=Object.keys(e).map(e=>e.toUpperCase()),e=Object.values(e);const n={};e.forEach((e,t)=>{n[t.toString()]=String(e)});e={values:n};if(a){const s={};Object.keys(a).forEach(e=>{s[e.toUpperCase()]=String(a[e])}),e.pk=s}t={serviceName:"DatasetSP.save",requestBody:{entityName:t,fields:o,records:[e]}};return JX.post(r,t)}static deletar(e,t){var a=window.location.origin+"/mge/service.sbr?serviceName=DatasetSP.removeRecord&outputType=json",e={serviceName:"DatasetSP.removeRecord",requestBody:{entityName:e,pks:t instanceof Array?t:[t]}};return JX.post(a,e)}static removerFrame({instancia:e,paginaInicial:r,...a}={instancia:"",paginaInicial:"app.jsp"}){new Promise(t=>{window.parent.document.getElementsByTagName("body").length&&(window.parent.document.querySelector("div.gwt-PopupPanel.alert-box.box-shadow")&&(window.parent.document.querySelector("div.gwt-PopupPanel.alert-box.box-shadow").style.display="none"),window.parent.document.getElementsByTagName("body")[0].style.overflow="hidden"),window.parent.parent.document.getElementsByTagName("body").length&&(window.parent.parent.document.querySelector("div.gwt-PopupPanel.alert-box.box-shadow")&&(window.parent.parent.document.querySelector("div.gwt-PopupPanel.alert-box.box-shadow").style.display="none"),window.parent.parent.document.getElementsByTagName("body")[0].style.overflow="hidden"),(e=window.parent.document.querySelector("div.GI-BUHVBPVC > div > div > div > div > div > table > tbody > tr > td > div")?window.parent.document.querySelector("div.GI-BUHVBPVC > div > div > div > div > div > table > tbody > tr > td > div").textContent:e)&&0<e.length?JX.consultar(`SELECT NUGDG FROM TSIGDG WHERE TITULO = '${e}'`).then(e=>t({gadGetID:"html5_z6dld",nuGdt:e[0].NUGDG,...a})):t({gadGetID:"html5_z6dld",nuGdt:0,...a})}).then(a=>setTimeout(()=>{if(void 0!==window.parent.document.getElementsByClassName("DashWindow")[0]){var e=Object.keys(a).filter(e=>!["params","UID","instance","nuGdg","gadGetID"].includes(e)).map(e=>`&${e}=`+a[e]).join("");const t=`/mge/html5component.mge?entryPoint=${r}&nuGdg=`+a.nuGdt+e;setTimeout(()=>window.parent.document.getElementsByClassName("dyna-gadget")[0].innerHTML=`<iframe src="${t}" class="gwt-Frame" style="width: 100%; height: 100%;"></iframe>`,500),setTimeout(()=>document.getElementsByClassName("popupContent").length?document.getElementsByClassName("popupContent")[0].parentElement.remove():void 0,2e4),setTimeout(()=>document.getElementById("stndz-style").parentElement.parentElement.getElementsByTagName("body")[0].style.overflow="hidden",2e4)}}))}static novaGuia(e=!1){(window.parent.parent.document.querySelector(".Taskbar-container")&&!e||e)&&Object.assign(document.createElement("a"),{target:"_blank",href:window.location.href}).click()}static abrirPagina(e,a){let r=JX.getUrl("/mge/system.jsp#app/%resID");if(r=r.replace("%resID",btoa(e)),a){let t={};Object.keys(a).forEach(function(e){t[e]=(isNaN(a[e])?String:Number)(a[e])}),r=r.concat("/"+btoa(JSON.stringify(t)))}Object.assign(document.createElement("a"),{target:"_top",href:r}).click()}static fecharPagina(){window.parent.parent.document.querySelector(".Taskbar-container")?window.parent.parent.document.querySelector("li.ListItem.AppItem.AppItem-selected div.Taskbar-icon.icon-close").click():window.close()}static getUrl(e){return""+window.location.origin+(e?"/"+e.replace("/",""):"")}static getCookie(e){var t,a=decodeURIComponent(document.cookie);if(e&&"string"==typeof e&&e.length){for(t of a.split(";")){var[r,o]=t.split("=");if(r.trim()===e)return o}return""}return a}static getArquivo(e){return JX.get(e,{headers:{"Content-Type":"text/plain"}})}static _converterTuplas(e){var t=[];function i(o,n,s){var e,t,a,r;Array.isArray(o)?(a=n,r=s,o.forEach(e=>i(e,a,r))):o&&"object"==typeof o&&(o.hasOwnProperty("key")&&o.hasOwnProperty("value")?(e=function(e){let t=null;switch(e.type){case"L":t="true"===e.value;break;case"I":case"F":t=Number(e.value);break;case"T":t=e.value;break;case"C":var a=(e.listContent||"").split("\n"),r=parseInt(e.value,10);t=a[r]||null;break;case"D":t=e.value?new Date(e.value.subString(6,10),(Number(e.value.subString(3,5))-1).toString(),e.value.subString(0,2)):null}return t}(o),t=o.name,s.push([n+o.key,e,t])):Object.keys(o).forEach(e=>{var t,a,r;"node"!==e&&"nodeName"!==e||(t=o,a=n,t="nodeName"===(r=e)?a+t[r]+".":a,i(o[e],t,s))}))}return i(e.node,"",t),t}static _montagemSerializacaoParametros(e,t,a=!1){var r={},o=e.flat(1);if(a)for(const s of o)r[s[0]]=s[1];else for(const i of t){var n=o.filter(e=>{return[e[0],e[2]].includes(i)})[0];n&&null!==n[1]&&void 0!==n[1]&&""!==n[1]?r[i]=n[1]:r[i]=null}return r}static async getParametro(e=""){if(!("string"==typeof(e=null==e?"":e)||Array.isArray(e)))throw new Error("Forneça o nome dos parametros a serem buscados como Texto ou Array de Textos!");if(Array.isArray(e)&&!e.every(e=>null!=e&&"string"==typeof e&&e.length))throw new Error("Os parametros informados devem ser Textos não vazios!");var t=0===e.length,e="string"==typeof(e=Array.isArray(e)&&t?"":e)||0===e.length?[e]:e,a="ManutencaoPreferenciasSP.getParametrosComoEstrutura";const r=window.location.origin+`/mge/service.sbr?serviceName=${a}&outputType=json`,o={serviceName:a,requestBody:{param:{value:""}}};a=e.map(async e=>{o.requestBody.param.value=e;e=await JX.post(r,o);return JX._converterTuplas(e.responseBody.root)||[]}),a=await Promise.all(a);return JX._montagemSerializacaoParametros(a,e,t)}static _formatarRequisicaoChamadaServico(e,t,a,r=!0){let o;switch(!0){case r&&a&&"object"==typeof a:e+="&outputType=json",o=JSON.stringify({serviceName:t,requestBody:a});break;case r&&a&&"string"==typeof a:e+="&outputType=json",o=a;break;default:o=a}return[e,o]}static _formatarUrlChamadaServico(e,t,a){var r=JX.getCookie("JSESSIONID").replace(/\..*/,"");let o=window.location.origin+`/${e}/service.sbr?serviceName=${t}&mgeSession=`+r;var n="&counter=1&preventTransform=false",s=["SelecaoDocumento","br.com.sankhya.mgecom.mov.selecaodedocumento"],i=["MovimentacaoFinanceira","br.com.sankhya.fin.cad.movimentacaoFinanceira"],c=["ConsultaOS","br.com.sankhya.os.mov.OrdemServico"];switch(e){case"mgecom":o=o+n+`&application=${s[0]}&resourceID=`+s[1];break;case"mgefin":o=o+n+`&application=${i[0]}&resourceID=`+i[1];break;case"mgeos":o=o+n+`&application=${c[0]}&resourceID=`+c[1];break;default:o=o+n+"&application="+a}return o}static async chamarServico(e,t,a={aplicacao:"workspace",cabecalho:{"Content-Type":"application/json; charset=UTF-8"}}){let r="mge",o="workspace";var n=null;let s={};if(!e||"string"!=typeof e||e.length<1)throw new Error("O serviço deve ser informado!");e.includes("@")&&([r,e]=e.split("@")),a&&(o=a.aplicacao||o,s={...a.cabecalho||{}});var a=t&&("string"==typeof t&&!t.startsWith("<")||"object"==typeof t),i={...s,"Content-Type":a?"application/json; charset=UTF-8":"text/xml; charset=UTF-8"},c=JX._formatarUrlChamadaServico(r,e,o),e=([c,n]=JX._formatarRequisicaoChamadaServico(c,e,t,a),await JX.post(c,n,{headers:i,raw:!0}));if(!e.ok)throw new Error("[JX] Erro não identificado.");t=a?await e.json():await e.text();if([0,3].includes(t.status))throw t;return[2,4].includes(t.status)&&console.warn("[JX] "+t.statusMessage),t}}