class JX{static async post(e,t,{headers:r}={headers:{}}){let o="",n=!0;r&&(n=(o=r["Content-Type"]?String(r["Content-Type"]):o).length<1||o.includes("json"),r["Content-Type"]&&delete r["Content-Type"],r["Content-Type"]=n?"application/json; charset=UTF-8":o);try{const o=await window.fetch.bind(window)(e,{headers:r,method:"POST",redirect:"follow",body:n?JSON.Stringify(t):t});return n?o.json():o.text()}catch(e){console.error(e)}}static async get(e,{headers:t}={headers:{}}){let r="",o=!0;t&&(o=(r=t["Content-Type"]?String(t["Content-Type"]):r).length<1||r.includes("json"),t["Content-Type"]&&delete t["Content-Type"],t["Content-Type"]=o?"application/json; charset=UTF-8":r);try{const r=await window.fetch.bind(window)(e,{headers:t,method:"GET",redirect:"follow",mode:"no-cors"});return o?r.json():r.text()}catch(e){console.error(e)}}static async consultar(e){e=e.replace(/(\r\n|\n|\r)/gm,"");const t=`${window.location.origin}/mge/service.sbr?serviceName=DbExplorerSP.executeQuery&outputType=json`;let r=`{ "serviceName": "DbExplorerSP.executeQuery", "requestBody": { "sql": "${e}" } }`;return r=JSON.parse(r),function(e){let t=[],r="string"==typeof e?JSON.parse(e):e;r.data?r=r.data.responseBody:r.responseBody&&(r=r.responseBody);let o=r.fieldsMetadata||[],n=r.rows||[];return n.length&&n.forEach(e=>{let r={};o.forEach((t,o)=>r[t.name]=e[o]),t.push(r)}),t}(await JX.post(t,r))}static acionarBotao(e,{tipo:t,idBotao:r,entidade:o,nomeProcedure:n}={tipo:"java",idBotao:0}){function a(e){let t={params:{param:[]}};return Object.keys(e).forEach(r=>t.params.param.push({type:"string"==typeof e[r]?"S":"I",paramName:r,$:e[r]})),t}let s="",i={};switch(t.toLowerCase()){case"js":i={serviceName:s="ActionButtonsSP.executeScript",requestBody:{runScript:{actionID:r,...a(e)}}};break;case"java":i={serviceName:s="ActionButtonsSP.executeJava",requestBody:{javaCall:{actionID:r,...a(e)}}};break;case"sql":if(!o)return void console.error("Entidade (parametro entidade) é necessária para a execução!");if(!n)return void console.error("Nome da procedure (parametro nomeProcedure) é necessária para a execução!");i={serviceName:s="ActionButtonsSP.executeSTP",requestBody:{stpCall:{actionID:r,rootEntity:o,procName:n,...a(e)}}}}const c=`${window.location.origin}/mge/service.sbr?serviceName=${s}&outputType=json`;return JX.post(c,i)}static _salvar(e,t,r){const o=`${window.location.origin}/mge/service.sbr?serviceName=CRUDServiceProvider.saveRecord&outputType=json`,n=function(e,t,r){let o={serviceName:"CRUDServiceProvider.saveRecord",requestBody:{dataSet:{rootEntity:t,includePresentationFields:"N",dataRow:{localFields:Object.keys(e).reduce((t,r)=>({...t,[r.toUpperCase()]:{$:String(e[r])}}),{})},entity:{fieldset:{list:Object.keys(e).map(e=>e.toUpperCase()).join(",")}}}}};if(r){let e={};Object.keys(r).forEach(t=>e={...e,[t.toUpperCase()]:{$:String(r[t])}}),o.requestBody.dataSet.dataRow.key=e}return o}(e,t,r);return JX.post(o,n)}static async salvar(e,t,r){let o=[];if(!(r&&r instanceof Array&&r.length))return JX._salvar(e,t,r);for(let n of r)o.push(await JX._salvar(e,t,n));return o}static deletar(e,t){const r=`${window.location.origin}/mge/service.sbr?serviceName=DatasetSP.removeRecord&outputType=json`,o={serviceName:"DatasetSP.removeRecord",requestBody:{entityName:e,pks:t instanceof Array?t:[t]}};return JX.post(r,o)}static removerFrame({instancia:e,paginaInicial:t,...r}={instancia:"",paginaInicial:"app.jsp"}){new Promise(t=>{window.parent.document.getElementsByTagName("body").length&&(window.parent.document.querySelector("div.gwt-PopupPanel.alert-box.box-shadow")&&(window.parent.document.querySelector("div.gwt-PopupPanel.alert-box.box-shadow").style.display="none"),window.parent.document.getElementsByTagName("body")[0].style.overflow="hidden"),window.parent.parent.document.getElementsByTagName("body").length&&(window.parent.parent.document.querySelector("div.gwt-PopupPanel.alert-box.box-shadow")&&(window.parent.parent.document.querySelector("div.gwt-PopupPanel.alert-box.box-shadow").style.display="none"),window.parent.parent.document.getElementsByTagName("body")[0].style.overflow="hidden"),window.parent.document.querySelector("div.GI-BUHVBPVC > div > div > div > div > div > table > tbody > tr > td > div")&&(e=window.parent.document.querySelector("div.GI-BUHVBPVC > div > div > div > div > div > table > tbody > tr > td > div").textContent),e&&e.length>0?JX.consultar(`SELECT NUGDG FROM TSIGDG WHERE TITULO = '${e}'`).then(e=>t({gadGetID:"html5_z6dld",nuGdt:e[0].NUGDG,...r})):t({gadGetID:"html5_z6dld",nuGdt:0,...r})}).then(e=>setTimeout(()=>{if(void 0!==window.parent.document.getElementsByClassName("DashWindow")[0]){const r=Object.keys(e).filter(e=>!["params","UID","instance","nuGdg","gadGetID"].includes(e)).map(t=>`&${t}=${e[t]}`).join(""),o=`/mge/html5component.mge?entryPoint=${t}&nuGdg=${e.nuGdt}${r}`;setTimeout(()=>window.parent.document.getElementsByClassName("dyna-gadget")[0].innerHTML=`<iframe src="${o}" class="gwt-Frame" style="width: 100%; height: 100%;"></iframe>`,500),setTimeout(()=>document.getElementsByClassName("popupContent").length?document.getElementsByClassName("popupContent")[0].parentElement.remove():void 0,2e4),setTimeout(()=>document.getElementById("stndz-style").parentElement.parentElement.getElementsByTagName("body")[0].style.overflow="hidden",2e4)}}))}static novaGuia(e=!1){(window.parent.parent.document.querySelector(".Taskbar-container")&&!e||e)&&Object.assign(document.createElement("a"),{target:"_blank",href:window.location.href}).click()}static abrirPagina(e,t){let r=JX.getUrl("/mge/system.jsp#app/%resID");if(r=r.replace("%resID",btoa(e)),t){let e={};Object.keys(t).forEach(function(r){e[r]=isNaN(t[r])?String(t[r]):Number(t[r])}),r=r.concat(`/${btoa(JSON.Stringify(e))}`)}Object.assign(document.createElement("a"),{target:"_top",href:r}).click()}static fecharPagina(){window.parent.parent.document.querySelector(".Taskbar-container")?window.parent.parent.document.querySelector("li.ListItem.AppItem.AppItem-selected div.Taskbar-icon.icon-close").click():window.close()}static getUrl(e){return`${window.location.origin}${e?"/"+e.replace("/",""):""}`}static getCookie(e){const t=decodeURIComponent(document.cookie);if(e&&"string"==typeof e&&e.length){const r=t.split(";");for(let t of r){if(t.split("=")[0].trim()===e)return t.split("=")[1]}return""}return t}static getArquivo(e){return JX.get(e,{headers:{"Content-Type":"text/plain"}})}static _converterTuplas(e){let t=[];function r(e,t,o){if(Array.isArray(e))!function(e,t,o){e.forEach(e=>r(e,t,o))}(e,t,o);else if(e&&"object"==typeof e)if(e.hasOwnProperty("key")&&e.hasOwnProperty("value")){let r=function(e){let t=null;switch(e.type){case"L":t="true"===e.value;break;case"I":case"F":t=Number(e.value);break;case"T":t=e.value;break;case"C":t=(e.listContent||"").split("\n")[parseInt(e.value,10)]||null;break;case"D":t=e.value?new Date(e.value.subString(6,10),(Number(e.value.subString(3,5))-1).toString(),e.value.subString(0,2)):null}return t}(e),n=e.name;o.push([t+e.key,r,n])}else Object.keys(e).forEach(n=>{if("node"===n||"nodeName"===n){const a=function(e,t,r){return"nodeName"===r?t+e[r]+".":t}(e,t,n);r(e[n],a,o)}})}return r(e.node,"",t),t}static _montagemSerializacaoParametros(e,t,r=!1){const o={},n=e.flat(1);if(r)for(const e of n){const t=e[0],r=e[1];o[t]=r}else for(const e of t){const t=n.filter(t=>{return[t[0],t[2]].includes(e)})[0];t&&null!==t[1]&&void 0!==t[1]&&""!==t[1]?o[e]=t[1]:o[e]=null}return o}static async getParametro(e=""){if(null==e&&(e=""),!("string"==typeof e||Array.isArray(e)))throw new Error("Forneça o nome dos parametros a serem buscados como Texto ou Array de Textos!");if(Array.isArray(e)&&!e.every(e=>null!=e&&"string"==typeof e&&e.length))throw new Error("Os parametros informados devem ser Textos não vazios!");const t=0===e.length,r="string"==typeof(e=Array.isArray(e)&&t?"":e)||0===e.length?[e]:e,o="ManutencaoPreferenciasSP.getParametrosComoEstrutura",n=`${window.location.origin}/mge/service.sbr?serviceName=${o}&outputType=json`,a={serviceName:o,requestBody:{param:{value:""}}},s=r.map(async e=>{a.requestBody.param.value=e;const t=await JX.post(n,a);return JX._converterTuplas(t.responseBody.root)||[]}),i=await Promise.all(s);return JX._montagemSerializacaoParametros(i,r,t)}}