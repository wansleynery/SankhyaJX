class JX{static async post(e,t,{headers:n}={headers:{}}){let o="",r=!0;n&&(r=(o=n["Content-Type"]?String(n["Content-Type"]):o).length<1||o.includes("json"),n["Content-Type"]&&delete n["Content-Type"],n["Content-Type"]=r?"application/json":o);try{const o=await window.fetch.bind(window)(e,{headers:n,method:"POST",redirect:"follow",body:r?JSON.stringify(t):t});return r?o.json():o.text()}catch(e){console.error(e)}}static async get(e,{headers:t}={headers:{}}){let n="",o=!0;t&&(o=(n=t["Content-Type"]?String(t["Content-Type"]):n).length<1||n.includes("json"),t["Content-Type"]&&delete t["Content-Type"],t["Content-Type"]=o?"application/json":n);try{const n=await window.fetch.bind(window)(e,{headers:t,method:"GET",redirect:"follow",mode:"no-cors"});return o?n.json():n.text()}catch(e){console.error(e)}}static async consultar(e){const t=`${window.location.origin}/mge/service.sbr?serviceName=DbExplorerSP.executeQuery&outputType=json`;let n=`{ "serviceName": "DbExplorerSP.executeQuery", "requestBody": { "sql": "${e}" } }`;return n=JSON.parse(n),function(e){let t=[],n="string"==typeof e?JSON.parse(e):e;n.data?n=n.data.responseBody:n.responseBody&&(n=n.responseBody);let o=n.fieldsMetadata||[],r=n.rows||[];return r.length&&r.forEach(e=>{let n={};o.forEach((t,o)=>n[t.name]=e[o]),t.push(n)}),t}(await JX.post(t,n))}static acionarBotao(e,{tipo:t,idBotao:n,resourceID:o}={tipo:"java",idBotao:0,resourceID:""}){function r(e){let t={params:{param:[]}};return Object.keys(e).forEach(n=>t.params.param.push({type:"string"==typeof e[n]?"S":"I",paramName:n,$:e[n]})),t}let a="",s={};switch(t.toLowerCase()){case"js":s={serviceName:a="ActionButtonsSP.executeScript",requestBody:{runScript:{actionID:n,...r(e)}}};break;case"java":s={serviceName:a="ActionButtonsSP.executeJava",requestBody:{javaCall:{actionID:n,...r(e)}}}}const i=`${window.location.origin}/mge/service.sbr?serviceName=${a}&outputType=json&resourceID=${o}`;return JX.post(i,s)}static async salvar(e,t,n){function o(e,t,n){const o=`${window.location.origin}/mge/service.sbr?serviceName=CRUDServiceProvider.saveRecord&outputType=json`,r=function(e,t,n){var o={serviceName:"CRUDServiceProvider.saveRecord",requestBody:{dataSet:{rootEntity:t,includePresentationFields:"N",dataRow:{localFields:Object.keys(e).reduce((t,n)=>({...t,[n.toUpperCase()]:{$:String(e[n])}}),{})},entity:{fieldset:{list:Object.keys(e).map(e=>e.toUpperCase()).join(",")}}}}};if(n){let e={};Object.keys(n).forEach(t=>e={...e,[t.toUpperCase()]:{$:String(n[t])}}),o.requestBody.dataSet.dataRow.key=e}return o}(e,t,n);return JX.post(o,r)}let r=[];if(!(n&&n instanceof Array&&n.length))return o(e,t,n);for(let a of n)r.push(await o(e,t,a));return r}static async deletar(e,t){function n(e,t){const n=`${window.location.origin}/mge/service.sbr?serviceName=DatasetSP.removeRecord&outputType=json`,o={serviceName:"DatasetSP.removeRecord",requestBody:{entityName:e,pks:[t]}};return JX.post(n,o)}let o=[];if(!(t&&t instanceof Array&&t.length))return n(e,t);for(let r of t)o.push(await n(e,r));return o}static removerFrame(e={instance:"",initialPage:"app.jsp",params:void 0,UID:0,nuGdt:0}){function t(e,t){e&&t()}new Promise(n=>{window.parent.document.getElementsByTagName("body").length&&(t(window.parent.document.querySelector("div.gwt-PopupPanel.alert-box.box-shadow"),()=>window.parent.document.querySelector("div.gwt-PopupPanel.alert-box.box-shadow").style.display="none"),window.parent.document.getElementsByTagName("body")[0].style.overflow="hidden"),window.parent.parent.document.getElementsByTagName("body").length&&(t(window.parent.parent.document.querySelector("div.gwt-PopupPanel.alert-box.box-shadow"),()=>window.parent.parent.document.querySelector("div.gwt-PopupPanel.alert-box.box-shadow").style.display="none"),window.parent.parent.document.getElementsByTagName("body")[0].style.overflow="hidden");let o="";(o=window.parent.document.querySelector("div.GI-BUHVBPVC > div > div > div > div > div > table > tbody > tr > td > div")?window.parent.document.querySelector("div.GI-BUHVBPVC > div > div > div > div > div > table > tbody > tr > td > div").title:"string"==typeof e?e:e.instance).length>0?JX.consultar(`SELECT NUGDG FROM TSIGDG WHERE TITULO = '${o}'`).then(t=>n({..."string"==typeof e?{}:e,gadGetID:"html5_z6dld",params:void 0,nuGdt:t[0].NUGDG})):n({..."string"==typeof e?{}:e,gadGetID:"html5_z6dld",params:void 0,nuGdt:e.nuGdt})}).then(t=>setTimeout(()=>{if(void 0!==window.parent.document.getElementsByClassName("DashWindow")[0]){const n=Object.keys(t).filter(e=>!["params","UID","instance","nuGdg","gadGetID"].includes(e)).map(e=>`&${e}=${t[e]}`).join(""),o=`/mge/html5component.mge?entryPoint=${e.initialPage?e.initialPage:"app.jsp"}&nuGdg=${t.nuGdt}${n}${t.params?"&params="+window.atob(t.params):""}`;setTimeout(()=>window.parent.document.getElementsByClassName("dyna-gadget")[0].innerHTML=`<iframe src="${o}" class="gwt-Frame" style="width: 100%; height: 100%;"></iframe>`,500),setTimeout(()=>document.getElementsByClassName("popupContent").length?document.getElementsByClassName("popupContent")[0].parentElement.remove():void 0,3e4),setTimeout(()=>document.getElementById("stndz-style").parentElement.parentElement.getElementsByTagName("body")[0].style.overflow="hidden",3e4)}}))}static novaGuia(e=!1){(window.parent.parent.document.querySelector(".Taskbar-container")&&!e||e)&&Object.assign(document.createElement("a"),{target:"_blank",href:window.location.href}).click()}static abrirPagina({resourceID:e,chavesPrimarias:t}){const n=`<serviceRequest serviceName="WorkspaceSP.openItemMenu">\n                <requestBody>\n                    <itemMenu resourceID="${e}"${t?' pk="'+Buffer.from(JSON.stringify(t),"utf8").toString("base64")+'"':""} />\n                </requestBody>\n            </serviceRequest>`;JX.post(`${JX.getUrl()}/mge/service.sbr?serviceName=WorkspaceSP.openItemMenu`,n,{headers:{"Content-Type":"application/xml"}}).then(e=>{const t=e.match(/(.*)\n(.*)/)[2].match(/(.*)<json><!\[CDATA\[(.*)\]\]><\/json>(.*)/),n=JSON.parse(t[2]);Object.assign(document.createElement("a"),{target:"_blank",href:JX.getUrl(n.onclick)}).click()})}static fecharPagina(){window.parent.parent.document.querySelector(".Taskbar-container")?window.parent.parent.document.querySelector("li.ListItem.AppItem.AppItem-selected div.Taskbar-icon.icon-close").click():window.close()}static async getUrl(e){return Promise.resolve(`${window.location.origin}${e?"/"+e.replace(/^[\/]+/,""):""}`)}static async getCookie(e){const t=decodeURIComponent(document.cookie);if(e&&e.length){const n=t.split(";");for(let t of n){if(t.split("=")[0].trim()===e)return t.split("=")[1]}return Promise.resolve("")}return Promise.resolve(t)}static getArquivo(e){return JX.get(e,{headers:{"Content-Type":"text/plain"}})}}
